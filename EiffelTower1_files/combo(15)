YUI.add("flickr-favorites-getList-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-favorites-getList"]={run:function(o,s){var r=this;return e.Promise.all([s.callAPI("flickr.favorites.getList",this._processParams(o)),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t){var o={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||20,page:t.page||1,get_user_info:1,jump_to:t.withPhotoId||""};if(t.id||t.userId)o.user_id=(t.id||t.userId).split("-")[0];else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");o.path_alias=t.pathAlias}return o},_processResponse:function(t,o){var s,r,a=t[0],i=t[1],p=t[2],l=t[3],d=t[4],g=t[5],n={id:a.user.nsid,pathAlias:a.user.pathAlias,totalItems:a.photos.total},h=o.id||o.userId;return h&&h!==n.id&&(n.id=h),r=e.APIHelper.response.parsePerson(a.user),n.owner=p.addOrUpdate(r),s=e.APIHelper.response.parsePhotos({photos:a.photos.photo,personModelRegistry:p,photoModelRegistry:i,photoEngagementModelRegistry:d,photoStatsModelRegistry:g}),n.photoPageList={perPage:a.photos.perpage,page:a.photos.page,pageContent:s,totalItems:a.photos.total},l.addOrUpdate(n),s}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","favorite-models","photo-engagement-models","photo-stats-models"]});YUI.add("favorite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-favorites-getList"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"favorites"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t,r=this.appContext.getViewer(),i=this.getValue(e,"normalizedId");return r&&r.nsid===i?"Your favorites":(t=this.getValue(e,"owner"))?t.getValue("displayname")+"'s favorites":"Favorites"}},pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-favorites-getList"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-favorites-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),r=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):r)+"/favorites/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return"faves-"+this.getValue(e,"owner").getValue("pathAlias")}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-favorites-getContext-fetcher","flickr-favorites-getList-fetcher","photo-model-helper"]});YUI.add("hermes-lang-shared-entity",function(o,e){o.Intl.add("hermes/shared-entity","en-US",{USERNAME_HAS_SHARED_PHOTOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," with you!"],USERNAME_HAS_SHARED_VIDEOS_ONLY:["${username}"," has shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}}," with you!"],USERNAME_HAS_SHARED_PHOTOS_VIDEOS:["${username}"," has shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}}," with you!"],OWNER_HAS_SHARED_PHOTOS_ONLY:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}},"."],OWNER_HAS_SHARED_VIDEOS_ONLY:["You have shared ",{type:"plural",valueName:"videoCount",options:{one:"${#} video",other:"${#} videos"}},"."],OWNER_HAS_SHARED_PHOTOS_VIDEOS:["You have shared ",{type:"plural",valueName:"photoCount",options:{one:"${#} photo",other:"${#} photos"}}," ",{type:"plural",valueName:"videoCount",options:{one:"and ${#} video",other:"and ${#} videos"}},"."],VIEW_YOUR_SHARING_HISTORY:["View your sharing history"]})},"@VERSION@",{requires:["intl"]});YUI.add("photo-sets-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("flickr-photosets-addPhoto-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-addPhoto"]={run:function(t,s){var l={full_response:1},u=[],d=t.isMultiplePhotos?"photo_ids":"photo_id",r=t.photoID.split(",").length;return l[d]=t.photoID,l.photoset_id=t.setID,t.gpCode&&(l.gp_code=t.gpCode),t.gpOwner&&(l.gp_owner=t.gpOwner),t.shareCode&&(l.share_code=t.shareCode),t.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=t.userId),u=[s.callAPI("flickr.photosets.addPhoto",l),s.getModel("set-models",t.setID),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],t.isMultiplePhotos||u.push(s.getModel("photo-models",t.photoID)),e.Promise.all(u).then(function(e){var o,s=e[0],l=e[1],u=e[2],d=e[3],h=s.errors,i=s.errors?s.errors.length:0;if(r-=i,"ok"===s.stat)return t.isMultiplePhotos?l&&t.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")+t.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")+t.numberOfVideosSelected)):(o=e[4],l&&!l.hasPhoto(o.getValue("id"))&&(l.addPhoto(o),o.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")+1):l.setValue("photoCount",l.getValue("photoCount")+1))),u.exists(t.photoID)&&!u.getValue(t.photoID,"sets").getFromListByID(l.getValue("id"))&&(u.getValue(t.photoID,"sets").prependToList(l),u.setValue(t.photoID,"total",u.getValue(t.photoID,"total")+r)),d.exists(t.photoID)&&!d.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(d.setValue(t.photoID,"totalSets",d.getValue(t.photoID,"totalSets")+r),d.getValue(t.photoID,"contexts").push(l)),t.isMultiplePhotos?(i&&h.forEach(function(e){-1!==t.photosSelectedIds.indexOf(e.photo_id)?l.setValue("photoCount",l.getValue("photoCount")-1):l.setValue("videoCount",l.getValue("videoCount")-1)}),{errors:h,setModel:l}):l},function(t){return e.FetcherErrorLogger(o),t}.bind(this))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-getList-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-photosets-getList"]={run:function(s,o){var a=this,r=this._processParams(s);return e.Promise.all([o.callAPI("flickr.photosets.getList",r,!0),o.getModelRegistry("sets-models"),o.getModelRegistry("set-models"),o.getModel("person-models",s.id||{pathAlias:s.pathAlias})]).then(function(e){return a._processResponse(e,s)},e.FetcherErrorLogger(t))},_processParams:function(t){var s={primary_photo_extras:e.APIHelper.request.getRebootAlbumsListExtras(),page:t.page,per_page:t.perPage||500,get_user_info:1,extras:"can_share,can_download"};if(t.id)s.user_id=t.id;else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");s.path_alias=t.pathAlias}return s},_processResponse:function(t,s){var o,a,r=t[0],i=t[1],p=t[2],n=t[3],l=r.photosets,h={},d=n.getValue("id"),c=[];if(l)return l.photoset&&e.Array.each(l.photoset,function(t,s){if(0!==t.visibilityCanSeeSet){var o={id:t.id,title:t.title.content,description:t.description.content,owner:n,primary:t.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),isAutoUploadSet:t.autoUpload,primaryNeedsInterstitial:t.needsInterstitial,photoCount:t.photos,videoCount:t.videos,publicPhotosCount:t.countPhotosPublic,totalCount:parseInt(t.photos,10)+parseInt(t.videos,10),viewCount:t.countViews,canShare:t.canShare+(t.canShareDeep||0),canDownload:t.canDownload};c.push(p.addOrUpdate(o))}}),h={id:d,pathAlias:n.getValue("pathAlias"),totalItems:r.photosets.total},o=parseInt(r.photosets.perpage),a=parseInt(r.photosets.page),h.albumsList={perPage:o,page:a,pageContent:c,totalItems:r.photosets.total,totalPages:Math.ceil(r.photosets.total/o)},i.addOrUpdate(h),c}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]});YUI.add("sets-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photosets-getList"].run(e,this.appContext)}},attributes:{id:{},pathAlias:{},albumsList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-photosets-getList"]}},totalItems:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]});YUI.add("flickr-photosets-removePhoto-deletor",function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:function(o,s){var l={full_response:1},i=[],u=o.isMultiplePhotos?"photo_ids":"photo_id",r=o.photoID.split(",").length;return l[u]=o.photoID,l.photoset_id=o.setID,o.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=o.userId),i=[s.callAPI("flickr.photosets.removePhoto",l),s.getModel("set-models",o.setID),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")||o.includeHiddenSets?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),e.Promise.all(i).then(function(e){var t,s=e[0],l=e[1],i=e[2],u=e[3],d=e[4];if("ok"===s.stat)return d.exists(o.photoID)&&d.getValue(o.photoID,"contexts").getFromListByID(o.setID)&&(d.setValue(o.photoID,"totalSets",d.getValue(o.photoID,"totalSets")-r),d.getValue(o.photoID,"contexts").removeFromList(o.setID)),u.exists(o.photoID)&&u.getValue(o.photoID,"sets").getFromListByID(o.setID)&&(u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")-r),u.getValue(o.photoID,"sets").removeFromList(o.setID)),l&&(o.isMultiplePhotos?l&&o.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")-o.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")-o.numberOfVideosSelected)):(t=e[5],l.hasPhoto(t.getValue("id"))&&l.removePhoto(t),t.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-r):l.setValue("photoCount",l.getValue("photoCount")-r)),l.getValue("totalCount")<1&&!o.includeHiddenSets)?(i.getValue("albumsList").remove(o.setID),l.registry.remove(o.setID),null):l},e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-delete-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-photosets-delete-deletor"]={run:function(o,t){return o.photoset_id=o.setID,o.gpCode&&(o.gp_code=o.gpCode),o.gpOwner&&(o.gp_owner=o.gpOwner),o.shareCode&&(o.share_code=o.shareCode),t.callAPI("flickr.photosets.delete",o).then(function(e){if(1===e.code)throw new Error(e)}).catch(e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-getPhotos-fetcher",function(e,o){"use strict";var t=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("album-privacy-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o){o.page=o.page||1,o.perPage=o.perPage||100;var s={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage,page:o.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:o.withPhotoId||""};return o.gpCode&&null!==o.gpCode?(s.gp_code=o.gpCode,s.share_code=o.gpCode,s.gp_owner=o.gpOwner,t.info("Calling sets api with GP "+o.gpCode)):s.photoset_id=o.id.split("-")[0],o.includeHiddenSets&&(s.extras+=",hidden_sets",s.user_id=o.userId),o.viewAs&&(s.view_as=o.viewAs),o.filter&&(s.privacy_filter=o.filter),s},_processResponse:function(o,t){var s,r,p,i,a,n=o[0],h=o[1],l=o[2],d=o[3],u=o[4],g=o[5],c=o[6],P=[],m=!1,_=!1,y=t.id;s=e.APIHelper.response.parsePerson(n.user),r=l.addOrUpdate(s),p={id:t.id,title:n.photoset.title,description:n.photoset.description,owner:r,primary:n.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(n.photoset),isAutoUploadSet:n.photoset.isAutoUploadSet,isSharedEntity:n.photoset.hidden&&1===n.photoset.hidden,photoCount:n.photoset.photoCount,videoCount:n.photoset.videoCount,publicPhotosCount:n.photoset.countPhotosPublic,primaryNeedsInterstitial:n.photoset.needsInterstitial,totalCount:parseInt(n.photoset.photoCount,10)+parseInt(n.photoset.videoCount,10),photoList:[],viewCount:n.photoset.countViews,canShare:n.photoset.canShare+(n.photoset.canShareDeep||0),canDownload:n.photoset.canDownload},y&&y!==n.photoset.id&&(p.id=y),"1"===n.photoset.isAutoUploadSet&&(p.canShare=!1),d.exists(t.id)&&(m=!!(i=d.getValue(t.id,"photoPageList")).hasMinBoundary&&i.hasMinBoundary(),_=!!i.hasMaxBoundary&&i.hasMaxBoundary(),P=i.getList()),a=e.APIHelper.response.parsePhotos({photos:n.photoset.photo,ownerID:n.photoset.owner,personModelRegistry:l,photoModelRegistry:h,photoEngagementModelRegistry:u,photoStatsModelRegistry:g}),p.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:P,perPage:t.perPage,pageNum:t.page,hasMax:_,hasMin:m,totalItems:n.photoset.total,newPages:a}),p.photoPageList={perPage:n.photoset.perPage,page:n.photoset.page,pageContent:a,totalItems:n.photoset.total},p.photoList.length&&(p.primary=n.photoset.primary);var C={id:p.id,countPhotosFamily:n.photoset.countPhotosFamily,countPhotosFriend:n.photoset.countPhotosFriend,countPhotosPublic:n.photoset.countPhotosPublic,countPhotosFriendFamily:n.photoset.countPhotosFriendFamily,totalCount:n.photoset.countPhotosAll};return c.exists(C.id)?c.setValues(t.id,C):c.add(C),d.exists(p.id)?d.setValue(t.id,"photoPageList",p.photoPageList):d.add(p),a}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getContext",this._processParams(t,s),!0),s.getModelRegistry("set-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o,t){var s={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,get_photoset_info:1};return o.gpCode?(s.share_code=o.gpCode,s.share_owner=o.gpOwner,s.gp_code=o.gpCode,s.gp_owner=o.gpOwner):s.photoset_id=o.id,s},_processResponse:function(o,t){var s,r,n,p,h,i,a=o[0],d=o[1],g=o[2],l=o[3],u=o[4],m=o[5],c=[],x=[],y=g.proxy(t.photoId),M=[];return s=a.prevphotos,r=a.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:l,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:l,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),h=d.getValue(t.id,"photoContextList"),n=!!h.hasMinBoundary&&h.hasMinBoundary(),p=!!h.hasMaxBoundary&&h.hasMaxBoundary(),i=h.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:i,hasMin:n,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),d.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-create-creator",function(t,e){"use strict";t.namespace("ModelCreators")["flickr-photosets-create"]={run:function(o,s){var p={},i=[];return p.title=o.title,p.description=o.description,p.primary_photo_id=o.photoID,p.full_result=1,i=[s.callAPI("flickr.photosets.create",p),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),t.Promise.all(i).then(function(e){var s,p,i,l,r,h=e[0],d=e[1],a=e[2],n=e[3],u=e[4],g=e[5];return!!h.photoset.id&&(o.isMultiplePhotos?o.numberOfPhotosSelected+o.numberOfVideosSelected===1?(l=h.photoset.photos,r=h.photoset.videos):h.photoset.photos?(l=h.photoset.photos,r=0):(r=h.photoset.videos,l=0):(p=e[6],l=h.photoset.photos,r=h.photoset.videos),s={id:h.photoset.id,title:h.photoset.title.content,photoPageList:o.isMultiplePhotos?[]:[p],photoContextList:o.isMultiplePhotos?[]:[p],owner:a,primary:h.photoset.primary,primaryPhotoSizes:t.APIHelper.response.parsePrimaryPhotoSizes(h.photoset),isAutoUploadSet:!1,photoCount:l,videoCount:r,totalCount:1,viewCount:h.countViews||0},d.add(s),i=d.proxy(h.photoset.id),n.getValue("albumsList").unshift(i),u.exists(o.photoID)&&!u.getValue(o.photoID,"sets").getFromListByID(i.getValue("id"))&&(u.getValue(o.photoID,"sets").prependToList(i),u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")+1)),g.exists(o.photoID)&&!g.getValue(o.photoID,"contexts").getFromListByID(i.getValue("id"))&&(g.setValue(o.photoID,"totalSets",g.getValue(o.photoID,"totalSets")+1),g.getValue(o.photoID,"contexts").appendToList(i)),i)},t.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-createHidden-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:function(t,s){var r={},d=[];return r.photo_ids=t.photoIds,d=[s.callAPI("flickr.photosets.createHidden",r),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid)],e.Promise.all(d).then(function(e){var o,t=e[0],s=e[1],r=e[2];return!("ok"!==t.stat||!t.photoset.share_code)&&(o={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:r,gpCode:t.photoset.share_code,gpOwner:r.getValue("pathAlias")||r.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},s.add(o),s.proxy(o.id))},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-editMeta-updater",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(o,s){var i={},r=this;return i.photoset_id=o.photosetId,i.title=o.title,i.description=o.description,o.includeHiddenSets&&(i.extras="hidden_sets"),e.Promise.all([s.callAPI("flickr.photosets.editMeta",i),s.getModelRegistry("set-models")]).then(function(e){r._processResponse(e,o,s)},e.FetcherErrorLogger(t))},_processResponse:function(e,t,s){var i=e[0],r=e[1];if(i.photoset&&i.photoset.title&&i.photoset.description){if(!r.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");r.setValues(t.photosetId,{title:i.photoset.title.content,description:i.photoset.description.content})}else o.warn("No updated data returned from API.")}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-setPrimaryPhoto-updater",function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(o,e){var s={};return s.photoset_id=o.albumId,s.photo_id=o.photoId,e.callAPI("flickr.photosets.setPrimaryPhoto",s).then(null,r.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("set-models",function(e,t){function o(e){o.superclass.constructor.call(this,e)}var r=require("hermes-core/flog")(t);e.Models[this.name]=o,e.extend(o,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,o){return e.ModelCreators["flickr-photosets-create"].run(t,o)},createHidden:function(t,o){return e.ModelCreators["flickr-photosets-createHidden"].run(t,o)},addPhoto:function(t,o){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,o)},removePhoto:function(t,o){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,o)},update:function(t,o){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:t,title:o.title?o.title.newVal:this.getValue(t,"title"),description:o.description?o.description.newVal:this.getValue(t,"description")},this.appContext)},setPrimaryPhoto:function(t,o){return e.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(t,o)},delete:function(t){if("string"==typeof t){t={setID:t}}return e.ModelDeletors["flickr-photosets-delete-deletor"].run(t,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(t,o,i){r.warn("Using `getSizeToFit` is deprecated. See model comments for more details.");var n=e.PhotoModelHelper.getSizeToFit(t,o,e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return n&&(n.url=n.src),n},getLargestPrimaryPhotoSize:function(t,o){return e.PhotoModelHelper.getLargestSize(t,o)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},publicPhotosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"totalCount"),i="";return 0===(t-=o)&&0===o?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),0===r?i=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===r?i=this.intlMessage({intlName:"models.ONE_ITEM"}):r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:r})),i}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r="";return 0===t&&0===o?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"owner"),i="";return t&&!o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(o,10)}):t&&o&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:r.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(o,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(t){var o=e.PhotoModelHelper.getSizeToFit(t,{height:75,width:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return o?o.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),o=this.getValue(e,"isSharedEntity"),r=this.getValue(e,"normalizedId");return t&&!0===o?"/photos/"+t.getValue("pathAlias")+"/shares/"+r:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+r:void 0}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isSharedEntity:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canShare:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return this.getValue(e,"isSharedEntity")?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,o){var r=e;return t&&(r+="-"+t),o&&(t||(r+="-dateposted"),r+="-"+o),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],langBundles:["models","shared-entity"]});YUI.add("photo-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},groups:{isCollection:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("flickr-photos-getAllContexts-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:function(o,s){var l=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(o.scrappy=!0),e.Promise.all([s.callAPI("flickr.photos.getAllContexts",this._processParams(o),!0),s.getModelRegistry("person-models"),s.getModelRegistry("photo-contexts-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("gallery-models"),s.getModelRegistry("group-pool-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-groups-models"),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-galleries-models"),s.getModelRegistry("group-models")]).then(function(e){return l._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t){var o;return o={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+","+e.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"},t.scrappy&&(o.get_all_galleries=1,o.no_faves_context=1,o.per_type_limit=6,o.get_totals=1,o.sort="date-desc"),o},_processResponse:function(t,o){var s,l,r=t[0],a=t[1],p=t[2],d={},i=[],g=t[8],n=t[9],u=t[10],m=t[11];return d.faves=t[3],d.gallery=t[4],d.pool=t[5],d.set=t[6],d.stream=t[7],e.Object.each(d,function(t,o){r[o]&&e.Array.each(r[o],function(o){e.APIHelper.response.addContextToRegistry(o,t,a,m),i.push(t.proxy(o.id))})}),p.exists(o.id)||(s=p.add({id:o.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),p.setValue(o.id,"contexts",i)),g.addOrUpdate({id:o.id,total:r.totals&&r.totals.groups,groups:p.getContextsOfType(o.id,"group-pool-models")}),(l=p.getContextsOfType(o.id,"set-models")).forEach(function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))}),n.addOrUpdate({id:o.id,total:r.totals&&r.totals.sets,sets:l}),u.addOrUpdate({id:o.id,total:r.totals&&r.totals.galleries,galleries:p.getContextsOfType(o.id,"gallery-models")}),s}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("flickr-galleries-removePhoto-deletor",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:function(t,l){var r={},a=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return r.photo_id=t.photoID,r.gallery_id=a,e.Promise.all([l.callAPI("flickr.galleries.removePhoto",r),l.getModel("gallery-models",a),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models"),l.getModel("gallery-info-models",a)]).then(function(e){var o=e[0],l=e[1],r=e[2],s=e[3],i=e[4],g=e[5];if("ok"===o.stat)return i.exists(t.photoID)&&i.getValue(t.photoID,"contexts").getFromListByID(a)&&(i.setValue(t.photoID,"totalGalleries",i.getValue(t.photoID,"totalGalleries")-1),i.getValue(t.photoID,"contexts").removeFromList(a)),s.exists(t.photoID)&&s.getValue(t.photoID,"galleries").getFromListByID(a)&&(s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")-1),s.getValue(t.photoID,"galleries").removeFromList(a)),l&&(l.hasPhoto(r.getValue("id"))&&l.removePhoto(r),g.hasPhoto(r.getValue("id"))&&g.getValue("photoList").removeFromList(r.getValue("id")),r.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-1):l.setValue("photoCount",l.getValue("photoCount")-1),0===l.getValue("photoCount")+l.getValue("videoCount")&&(l.setValue("primary",null),l.setValue("primaryPhotoSizes",{}))),l},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-info-models"]});YUI.add("flickr-galleries-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.galleries.getContext",this._processParams(t),!0),s.getModelRegistry("gallery-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"Photo not in gallery"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{gallery_id:o.compoundId,photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext}},_processResponse:function(o,t){var s,r,n,l,p,a,i=o[0],g=o[1],h=o[2],d=o[3],u=o[4],m=o[5],c=[],y=[],x=h.proxy(t.photoId),M=[];return s=i.nextphotos,r=i.prevphotos,y=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:d,photoModelRegistry:h,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:d,photoModelRegistry:h,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=g.getValue(t.id,"photoContextList"),l=!!a.hasMinBoundary&&a.hasMinBoundary(),p=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:y,prev:c.reverse(),current:n,hasMin:l,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),g.setValue(t.id,"photoContextList",M),{next:y,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});