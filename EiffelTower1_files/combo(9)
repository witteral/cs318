YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:function(o,r){var s={};return o.fullResponse?(s.photo_ids=o.photoId,s.full_response=1):s.photo_id=o.photoId,s.safety_level=o.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",s).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[];return("title"in i||"description"in i)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title?i.title.newVal:this.getValue(t,"title"),description:i.description?i.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license.newVal},this.appContext)),"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:i.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,i){var r=[];return"safetyLevel"in i&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(i.safetyLevel,10),fullResponse:1},this.appContext)),"title"in i&&"description"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,description:i.description,fullResponse:1},this.appContext)):"title"in i?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:i.title,fullResponse:1},this.appContext)):"description"in i&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:i.description,fullResponse:1},this.appContext)),"license"in i&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:i.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getSizeForCanvas:e.PhotoModelHelper.getSizeForCanvas,getGuestpass:function(t){var i=this;return new e.Promise(function(e,r){i.getValue(t,"guestpass")?e():i.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){i.setValue(t,"guestpass",r.guestpass.url),e()})})},canVr:function(t){var i,r=!1;return this.appContext.flipper.isFlipped("enable-vr")?(this&&(i=this.getValue(t,"aspectRatio"))&&i>=1.99&&i<=2.01&&(r=!0),r?e.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:t})]).then(function(t){return e.Promise.resolve(!!t[0].is_equirectangular)}):e.Promise.resolve(!1)):e.Promise.resolve(!1)},attributes:{title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,canPublicComment:e.PhotoModelHelper.attributes.canPublicComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,owner:{isModel:!0},engagement:{isModel:!0},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},hasInvalidColorspaceForPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var i=this.getValue(t,"sizes");return e.Object.each(i,function(e,t){e.src=e.url}),i}},stats:{isModel:!0},visibilitySource:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},isVideoPending:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});YUI.add("photo-lite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{update:e.PhotoModelHelper.updateEngagement},toggleFave:e.PhotoModelHelper.toggleFave,addAsFave:e.PhotoModelHelper.addAsFave,getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,attributes:{owner:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{id:r.getValue(t,"ownerNsid"),getValue:function(e){return"id"===e?r.getValue(t,"ownerNsid"):"nsid"===e?r.getValue(t,"ownerNsid"):"url"===e?r.getValue(t,"ownerUrl"):r.getValue(t,e)},toJSON:function(){return{id:r.getValue(t,"ownerNsid"),url:r.getValue(t,"ownerUrl"),pathAlias:r.getValue(t,"pathAlias"),username:r.getValue(t,"username"),realname:r.getValue(t,"realname"),displayname:r.getValue(t,"displayname"),nsid:r.getValue(t,"ownerNsid"),ownerUrl:r.getValue(t,"ownerUrl"),isMe:r.getValue(t,"isMe")}},exists:function(e){return!1}}}},pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,ownerUrl:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,engagement:{readOnly:!0,isModel:!0,getter:function(e,t){var r=this;return{getValue:function(e){return r.getValue(t,e)},toJSON:function(){return{ownerNsid:r.getValue(t,"ownerNsid"),isFaved:r.getValue(t,"isFaved"),faveCount:r.getValue(t,"faveCount"),commentCount:r.getValue(t,"commentCount"),canFave:r.getValue(t,"canFave")}},exists:function(e){return!1}}}},ownerNsid:e.PhotoModelHelper.attributes.ownerNsid,isFaved:e.PhotoModelHelper.attributes.isFaved,faveCount:e.PhotoModelHelper.attributes.faveCount,commentCount:e.PhotoModelHelper.attributes.commentCount,canFave:e.PhotoModelHelper.attributes.canFave,title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,similaritySearchURL:e.PhotoModelHelper.attributes.similaritySearchURL,basicSimilaritySearchURL:e.PhotoModelHelper.attributes.basicSimilaritySearchURL,oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},hasInvalidColorspaceForPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","photo-model-helper","person-model-helper","flickr-favorites-add-updater","flickr-favorites-remove-updater","photo-models","photo-engagement-models","person-models"]});YUI.add("search-photos-lite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return t.getPhotoLiteModels=!0,e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{fetchParams:{getPhotoLiteModels:!0},listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher","attribute-helpers"]});YUI.add("flickr-photos-search-fetcher",function(e,o){"use strict";var t=require("superagent"),r=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photos-search"]={run:function(s,a){var p,i=this,l=s.emptyQuery?{}:this._processParams(e.merge({lang:a.lang||e.config.lang},s),a);if(l||(s.emptyQuery=!0),s.useV2API){var n=s.apiParams.tags||s.apiParams.text,h={orderBy:"interestingness",query:n,pageNumber:s.page-1>=0?s.page-1:0,pageSize:s.perPage,format:"json",nojsoncallback:1};s.minDateTaken&&s.maxDateTaken&&(s.apiParams.tags||s.apiParams.text)&&(h.query=e.SearchHelper.normalizeTag(n),h.context="tag:"+e.SearchHelper.normalizeTag(n)+" dateUploaded:["+s.minDateTaken+" TO "+s.maxDateTaken+"]"),p=[t.get("https://api.flickr.com/v2/media/search").use(require("hermes-core/req-id")).query(h).catch(function(e){return r.warn("API V2 Search returned a non valid response",{err:e}),{body:[],headers:{"x-total-count":0}}})]}else p=[s.emptyQuery?e.Promise.resolve({photos:{photo:[]}}):a.callAPI("flickr.photos.search",l)];return p=s.getPhotoLiteModels?p.concat([a.getModelRegistry("search-photos-lite-models"),a.getModelRegistry("photo-lite-models")]):p.concat([a.getModelRegistry("search-photos-models"),a.getModelRegistry("photo-models"),a.getModelRegistry("person-models"),a.getModelRegistry("photo-engagement-models"),a.getModelRegistry("photo-stats-models"),a.getModelRegistry("photo-geo-models")]),e.Promise.all(p).then(function(e){return i._processResponse(e,s)},e.FetcherErrorLogger(o))},_processParams:function(o,t){var r,s=e.merge(e.SearchHelper.UNIFIED_DEFAULT_PARAMS,{extras:e.APIHelper.request[o.getPhotoLiteModels?"getRebootPhotoLiteExtras":"getRebootPhotoExtras"](),per_page:o.perPage||50,page:o.page||"1",lang:o.lang});return o.fetchGeo&&(s.extras+=",geo"),o.additionalExtras&&(s.extras+=","+o.additionalExtras.join(",")),r=e.merge(s,o.apiParams||{}),o.privacyFilter&&(r.privacy_filter=o.privacyFilter),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),e.SearchHelper.isParameterlessSearch(r)?null:r},_processResponse:function(o,t){var r,s,a,p,i,l,n=o[0],h=o[1],d=o[2],g={id:t.id||e.SearchUrl.EMPTY_SEARCH_ID,apiParams:{},emptyQuery:!!t.emptyQuery,photos:[]};if(t.id&&t.id!==e.SearchUrl.EMPTY_SEARCH_ID&&(g.apiParams=e.QueryString.parse(t.id)),!t.id)throw new ReferenceError("No `id` provided by request.");if(!(t.useV2API||n.photos&&n.photos.photo)){var c=new Error("No `photos.photo` property returned by search API v1.");throw c.fatal=!0,c}var u=t.useV2API?n.body:n.photos.photo;return t.getPhotoLiteModels?a=u.map(function(o){return i=e.APIHelper.response.parsePhotoLite(o),d.addOrUpdate(i)}):(a=e.APIHelper.response.parsePhotos({photos:n.photos.photo,photoModelRegistry:d,personModelRegistry:o[3],photoEngagementModelRegistry:o[4],photoStatsModelRegistry:o[5]}),t.fetchGeo&&(r=o[6],n.photos.photo.forEach(function(e){p=void 0!==e.latitude?{id:e.id,hasGeo:!0,latitude:e.latitude,longitude:e.longitude}:{id:e.id,hasGeo:!1},r.addOrUpdate(p)}))),g.photos={perPage:t.useV2API?t.perPage:n.photos.perpage,page:t.useV2API?t.page:n.photos.page,pageContent:a,totalItems:t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),totalPages:t.useV2API?parseInt(n.headers["x-total-count"]/t.perPage,10):n.photos.pages/t.perPage},!t.useV2API&&n.photos.maxAllowedResults&&(g.photos.totalItems=Math.min(n.photos.maxAllowedResults,parseInt(n.photos.total,10))),!t.useV2API&&n.photos.maxAllowedPages&&(g.photos.totalPages=Math.min(n.photos.maxAllowedPages,n.photos.pages)),g.totalItems=t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),h.exists(g.id)?(s=h.getValue(g.id,"photos").getList(),l=s.filter(function(e){return!!e}).reduce(function(e,o){return e[o.id]=!0,e},{}),g.photos.pageContent=g.photos.pageContent.filter(function(e){return!l[e.id]}),1===g.photos.page&&(g.photos.forceAppend=!0),h.addOrUpdate(g)):h.add(g),a}}},"@VERSION@",{requires:["flickr-promise","search-helper","search-url","api-helper","querystring-parse-simple"],optional:["search-photos-models","search-photos-lite-models","photo-models","photo-lite-models","person-models","photo-engagement-models","photo-stats-models","photo-geo-models"],optionalRequires:["superagent"]});YUI.add("search-photos-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher"]});YUI.add("search-photos-yours-view",function(e){var i={"photo-models":{name:"photo-list-photo-view",params:{excludePeople:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-photo-view",params:{excludePeople:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}},t={jst:{rowHeight:150,subviewMapping:i},thm:{rowHeight:120,forceAspectRatio:1,subviewMapping:i},til:{rowHeight:210,forceAspectRatio:1,subviewMapping:{"photo-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}}},desc:{rowHeight:210,itemSpacing:{horizontal:4,vertical:70},subviewMapping:{"photo-models":{name:"photo-list-description-view"},"photo-lite-models":{name:"photo-list-description-view"}}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(i){var a,s,o,r,h;if(r=i.rowHeightMod||1,"til"===i.viewType&&(r=Math.max(1,i.rowHeightMod)),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-single-row",{loading:!0,title:this.intlMessage({intlName:"search.YOUR_PHOTOS"}),placeholderHeight:t[i.viewType].rowHeight*r}),this.unifiedSubviewParams=i.unifiedSubviewParams||{},this.unifiedSubviewParams.yours&&this.unifiedSubviewParams.yours.fetchParams?(this.fetchParams=this.unifiedSubviewParams.yours.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.yours.id,this.title=this.unifiedSubviewParams.yours.title):(this.apiParams={},this.fetchParams={}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),a=t[i.viewType].forceAspectRatio,s=e.clone(t[i.viewType].subviewMapping),o=e.clone(t[i.viewType].itemSpacing),i.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:this.searchId||this.searchUrl.getId(),collectionAttributeName:"photos",fetchParams:this.fetchParams},pageParams:e.merge(this.fetchParams),paginateOnScroll:!1,keepAwakeOnScroll:!0,parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchYourPhotosResultClick",itemIndexKey:"vespaRnk"}},measureAFT:!0,mobileLayout:i.allowMobileLayout?{}:null,layout:{containerPadding:{top:0,right:0,bottom:0,left:0},targetRowHeight:t[i.viewType].rowHeight*r,maxNumRows:1,alwaysDisplayOrphans:!0}},a&&(i.photoListConfig.layout.forceAspectRatio=a),s){if(i.photoListConfig.subviewMapping=s,!this.appContext.flipper.isFlipped("enable-similarity-search"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilar=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilarWithTerm=!1)}return o&&(i.photoListConfig.layout.itemSpacing=o),i.viewType===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified&&(i.photoListConfig.layout.itemSpacing={horizontal:4,vertical:4}),this.rowHeightMod=i.rowHeightMod,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var i=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then(function(e){i.searchModel=e,e.getValue("totalItems")<=0&&(i.emptySearch=!0)})},buildContainer:function(){return this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.emptySearch,total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:this.searchUrl.clone().setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0).getURL(),viewAllDataTrack:"search-viewall-user",title:this.title||this.intlMessage({intlName:"search.YOUR_PHOTOS"})}),this},buildHeadContainer:function(){this.set("headContainer",this.subviews["photo-list-view"].get("headContainer"))},activate:function(){return this},onParentViewEvent:function(e,i){switch(i&&i.length&&i[0]){case"search:layoutChange":i[1]&&this.handleLayoutChange(i[1])}},handleLayoutChange:function(i){var a,s=this.subviews["photo-list-view"],o=s.photoListLayout,r=t[i].forceAspectRatio,h=e.clone(t[i].subviewMapping),l=this.rowHeightMod;if(t.hasOwnProperty(i)){if("til"===i&&(l=Math.max(1,l)),o.targetRowHeight=t[i].rowHeight*l,o.forceAspectRatio=r,s.subviewMapping=h,!this.appContext.flipper.isFlipped("search-exclude-people"))for(a in h)s.subviewMapping[a].params.excludePeople=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(a in h)s.subviewMapping[a].params.searchSimilar=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(a in h)s.subviewMapping[a].params.searchSimilarWithTerm=!1;s.setItems(this.searchModel.getValue("photos").getList())}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-photos-single-row","photo-list-view","search-photos-lite-models","search-helper","person-preferences-models"],langBundles:["search","common"]});YUI.add("search-photos-contacts-view",function(e){var i={"photo-models":{name:"photo-list-photo-view",params:{excludePeople:!0,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-photo-view",params:{excludePeople:!0,searchSimilar:!0,searchSimilarWithTerm:!0}}},t={jst:{rowHeight:150,subviewMapping:i},thm:{rowHeight:120,forceAspectRatio:1,subviewMapping:i},til:{rowHeight:210,forceAspectRatio:1,subviewMapping:{"photo-models":{name:"photo-list-tile-view",params:{excludePeople:!0,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-tile-view",params:{excludePeople:!0,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}}},desc:{rowHeight:210,itemSpacing:{horizontal:4,vertical:70},subviewMapping:{"photo-models":{name:"photo-list-description-view"},"photo-lite-models":{name:"photo-list-description-view"}}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(i){var a,s,o,r,h;if(r=i.rowHeightMod||1,"til"===i.viewType&&(r=Math.max(1,i.rowHeightMod)),this.unifiedSubviewParams=i.unifiedSubviewParams||{},this.unifiedSubviewParams.contacts&&this.unifiedSubviewParams.contacts.fetchParams?(this.fetchParams=this.unifiedSubviewParams.contacts.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.contacts.id,this.title=this.unifiedSubviewParams.contacts.title):(this.apiParams={},this.fetchParams={}),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-single-row",{loading:!0,title:this.title||this.intlMessage({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"}),placeholderHeight:t[i.viewType].rowHeight*r}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),a=t[i.viewType].forceAspectRatio,s=e.clone(t[i.viewType].subviewMapping),o=e.clone(t[i.viewType].itemSpacing),i.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:this.searchId||this.searchUrl.getId(),collectionAttributeName:"photos",fetchParams:this.fetchParams},pageParams:e.merge(this.fetchParams),paginateOnScroll:!1,keepAwakeOnScroll:!0,parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchContactsPhotoResultClick",itemIndexKey:"vespaRnk"}},measureAFT:!0,mobileLayout:i.allowMobileLayout?{}:null,layout:{containerPadding:{top:0,right:0,bottom:0,left:0},targetRowHeight:t[i.viewType].rowHeight*r,maxNumRows:1,alwaysDisplayOrphans:!0}},a&&(i.photoListConfig.layout.forceAspectRatio=a),s){if(i.photoListConfig.subviewMapping=s,!this.appContext.flipper.isFlipped("search-exclude-people")||i.suppressExcludePeople)for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.excludePeople=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilar=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilarWithTerm=!1)}return o&&(i.photoListConfig.layout.itemSpacing=o),i.viewType===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified&&(i.photoListConfig.layout.itemSpacing={horizontal:4,vertical:4}),this.rowHeightMod=i.rowHeightMod,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var i=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then(function(e){i.searchModel=e,e.getValue("totalItems")<=0&&(i.emptySearch=!0)})},buildContainer:function(){return this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.emptySearch,total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:this.searchUrl.clone().setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0).getURL(),viewAllDataTrack:"search-viewall-contacts","photo-list-view":this.subviews["photo-list-view"].get("container"),title:this.title||this.intlMessage({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"})}),this},buildHeadContainer:function(){this.set("headContainer",this.subviews["photo-list-view"].get("headContainer"))},activate:function(){return this},onParentViewEvent:function(e,i){switch(i&&i.length&&i[0]){case"search:layoutChange":i[1]&&this.handleLayoutChange(i[1])}},handleLayoutChange:function(i){var a,s=this.subviews["photo-list-view"],o=s.photoListLayout,r=t[i].forceAspectRatio,h=e.clone(t[i].subviewMapping),p=this.rowHeightMod;if(t.hasOwnProperty(i)){if("til"===i&&(p=Math.max(1,p)),o.targetRowHeight=t[i].rowHeight*p,o.forceAspectRatio=r,s.subviewMapping=h,!this.appContext.flipper.isFlipped("search-exclude-people"))for(a in h)s.subviewMapping[a].params.excludePeople=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(a in h)s.subviewMapping[a].params.searchSimilar=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(a in h)s.subviewMapping[a].params.searchSimilarWithTerm=!1;s.setItems(this.searchModel.getValue("photos").getList())}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-photos-single-row","photo-list-view","search-photos-lite-models","search-helper","person-preferences-models"],langBundles:["search","common"]});YUI.add("hermes-template-search-filter-tools",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,r,l){var n,i=null!=a?a:{},t=s.helperMissing,o=e.escapeExpression;return'<div class="dropdown-link filter-license"><p class="option-header">'+o("function"==typeof(n=null!=(n=s.license||(null!=a?a.license:a))?n:t)?n.call(i,{name:"license",hash:{},data:l}):n)+'</p><span class="dropdown-arrow"></span></div>\n<div class="dropdown-link filter-safe-search"><p class="option-header">'+o("function"==typeof(n=null!=(n=s.safeSearch||(null!=a?a.safeSearch:a))?n:t)?n.call(i,{name:"safeSearch",hash:{},data:l}):n)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),r={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(r[a]=s)}),e.Template.register("hermes/search-filter-tools",function(a,l){return l=l||{},l.partials=l.partials?e.merge(r,l.partials):r,s(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-filter-tools-view",function(e){var t=[{intlKey:"search.ANY_LICENSE",value:"any",isDefault:!0},{intlKey:"search.ALL_CC",value:"2,3,4,5,6,9"},{intlKey:"search.COMMERCIAL_USE",value:"4,5,6,9,10"},{intlKey:"search.MODS_ALLOWED",value:"1,2,9,10"},{intlKey:"search.COMMERCIAL_USE_MODS",value:"4,5,9,10"},{intlKey:"search.NO_RESTRICTIONS",value:"7,9,10",isCommonsLicense:!0},{intlKey:"search.PUBLIC_DOMAIN_DEDICATION",value:"9",notInDropdown:!0},{intlKey:"search.PUBLIC_DOMAIN_WORK",value:"10",notInDropdown:!0},{intlKey:"search.US_GOVT",value:"8"}],s=[{intlKey:"search.SAFESEARCH_ON",value:"1",prefValue:0,isDefault:!0},{intlKey:"search.SAFESEARCH_MODERATE",value:"2",prefValue:1},{intlKey:"search.SAFESEARCH_OFF",value:"3",prefValue:2}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var r,i,n,l,c,h,o=this;return this.searchUrl=a.searchUrl?a.searchUrl.clone():new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.safeSearch),i=this.searchUrl.getAPIParam(e.SearchHelper.API.license),h=this.searchUrl.getAPIParam(e.SearchHelper.API.commons),i&&(n=e.SearchHelper.deriveCCLicenseString(this.searchUrl.getAPIParams()))&&this.set("selectedLicenseText",this.intlMessage(n)),this.safeSearches=[],s.forEach(function(t){l=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),r?l.value===r&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text),o.usedAPISafeSearch=!0):l.isDefault&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text)),o.safeSearches.push(l)}),this.licenses=[],t.forEach(function(t){c=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),t.itemFlag&&(c.itemFlag=o.intlMessage({intlName:t.itemFlag})),i?c.value===i&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):"true"===h||parseInt(h)?c.isCommonsLicense&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):c.isDefault&&!o.searchUrl.getAPIParam(e.SearchHelper.API.marketplace)&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)),c&&!c.notInDropdown&&o.licenses.push(c)}),this},loadState:function(){var t=this,s=[];return this.appContext.getViewer().signedIn&&s.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(e){t.set("viewerPrefsModel",e),t.safeSearches.forEach(function(s){s.isDefault=!1,t.usedAPISafeSearch||(s.isSelected=!1),s.prefValue===e.getValue("safeSearch")&&(t.usedAPISafeSearch||(s.isSelected=!0,t.set("selectedSafeSearch",s.value),t.set("selectedSafeSearchText",s.text)),s.isDefault=!0)})})),e.Promise.all(s)},buildContainer:function(){return this.setContainerWithTemplate("search-filter-tools",{license:this.get("selectedLicenseText"),safeSearch:this.get("selectedSafeSearchText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".filter-license").on("click",this.handleFilterLicense.bind(this))),this.registerEventHandler(this.get("container").one(".filter-safe-search").on("click",this.handleFilterSafeSearch.bind(this))),this},handleFilterLicense:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.licenses}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&e.menuItem.value!==s.get("selectedLicense")&&(s.set("selectedLicense",e.menuItem.value),s.set("selectedLicenseText",e.menuItem.text),s.get("container").one(".filter-license p").set("text",s.get("selectedLicenseText")),s.processUpdate()),s.dropdown.close()}))},handleFilterSafeSearch:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.safeSearches}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){if(e&&e.menuItem){if(!this.appContext.getViewer().signedIn&&(2===parseInt(e.menuItem.value,10)||3===parseInt(e.menuItem.value,10))&&this.appContext.flipper.isFlipped("enable-signed-out-cta-test"))return s.showSignUpModal(),void s.dropdown.close();s.set("selectedSafeSearch",e.menuItem.value),s.set("selectedSafeSearchText",e.menuItem.text),s.get("container").one(".filter-safe-search p").set("text",s.get("selectedSafeSearchText")),s.processUpdate()}s.dropdown.close()}))},processUpdate:function(){this.isDefaultLicenseValue()?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)):"marketplace"===this.get("selectedLicense")?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.setAPIParam(e.SearchHelper.API.marketplace,"1")):(this.searchUrl.setAPIParam(e.SearchHelper.API.license,this.get("selectedLicense")),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)),this.isDefaultSafeSearchValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.safeSearch):this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,this.get("selectedSafeSearch")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultLicenseValue:function(){var e=this;return this.licenses.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedLicense")},!1)},isDefaultSafeSearchValue:function(){var e=this;return this.safeSearches.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedSafeSearch")},!1)},showSignUpModal:function(){var t,s=e.config.win.location.href,a=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_TITLE"}),r=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-search-mature",signUpTitle:a,signUpMessage:r,beaconPrefix:"searchFilter"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:s})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:s})}),t.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-filter-tools","search-helper"],langBundles:["search","common"]});YUI.add("hermes-template-search-sort-menu",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,s,n){var t;return'<div class="dropdown-link sort-menu"><p class="option-header">'+e.escapeExpression("function"==typeof(t=null!=(t=r.sort||(null!=a?a.sort:a))?t:r.helperMissing)?t.call(null!=a?a:{},{name:"sort",hash:{},data:n}):t)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),s={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(s[a]=r)}),e.Template.register("hermes/search-sort-menu",function(a,n){return n=n||{},n.partials=n.partials?e.merge(s,n.partials):s,r(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-sort-menu-view",function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{initializer:function(t){var r,s=this;return this.set("sortMenuItems",t.sortMenuItems),this.searchUrl=t.searchUrl?t.searchUrl.clone():new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.sort),t.sortMenuItems&&t.sortMenuItems.length&&t.sortMenuItems.forEach(function(e){r?e.value===r&&(e.isSelected=!0,s.set("selectedSort",e.value),s.set("selectedSortText",e.text)):e.isDefault&&(e.isSelected=!0,s.set("selectedSort",e.value),s.set("selectedSortText",e.text))}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-sort-menu",{sort:this.get("selectedSortText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".sort-menu").on("click",this.handleSortMenu.bind(this))),this},handleSortMenu:function(t){var r=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:16,menuItems:this.get("sortMenuItems")}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(t){t&&t.menuItem&&t.menuItem.value!==r.get("selectedSort")&&(r.set("selectedSort",t.menuItem.value),r.set("selectedSortText",t.menuItem.text),r.get("container").one(".sort-menu p").set("text",r.get("selectedSortText")),r.searchUrl.searchType!==e.SearchUrl.searchTypes.PHOTOS&&r.isDefaultValue()?r.searchUrl.removeAPIParam(e.SearchHelper.API.sort):r.searchUrl.setAPIParam(e.SearchHelper.API.sort,r.get("selectedSort")),r.fire("subviewViewEvent","search:urlUpdate",r.searchUrl)),r.dropdown.close()}))},isDefaultValue:function(){var e=this;return this.get("sortMenuItems").reduce(function(t,r){return t||r.isDefault&&r.value===e.get("selectedSort")},!1)}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-sort-menu"]});YUI.add("hermes-template-search-color-picker",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,n,r){var t,o,s=null!=a?a:{},i=l.helperMissing,c=e.escapeExpression;return'\t\t<li class="color-swatch'+(null!=(t=l.if.call(s,null!=a?a.useDarkCheckMark:a,{name:"if",hash:{},fn:e.program(2,r,0),inverse:e.noop,data:r}))?t:"")+(null!=(t=l.if.call(s,null!=a?a.useOutline:a,{name:"if",hash:{},fn:e.program(4,r,0),inverse:e.noop,data:r}))?t:"")+(null!=(t=l.if.call(s,null!=a?a.selected:a,{name:"if",hash:{},fn:e.program(6,r,0),inverse:e.noop,data:r}))?t:"")+'" style="background-color: #'+c("function"==typeof(o=null!=(o=l.color||(null!=a?a.color:a))?o:i)?o.call(s,{name:"color",hash:{},data:r}):o)+'" data-color-code="'+c("function"==typeof(o=null!=(o=l.colorCode||(null!=a?a.colorCode:a))?o:i)?o.call(s,{name:"colorCode",hash:{},data:r}):o)+'" data-tooltip-title="'+c((l.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:r}))+'" tabindex="0" role="button" aria-label="'+c((l.intlMessage||a&&a.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:r}))+'"></li>\n'},2:function(e,a,l,n,r){return" dark-check"},4:function(e,a,l,n,r){return" outline"},6:function(e,a,l,n,r){return" checked"},compiler:[7,">= 4.0.0"],main:function(e,a,l,n,r){var t;return'<ul class="color-list">\n'+(null!=(t=l.each.call(null!=a?a:{},null!=a?a.colors:a,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r}))?t:"")+"</ul>\n"},useData:!0}),n={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)}),e.Template.register("hermes/search-color-picker",function(a,r){return r=r||{},r.partials=r.partials?e.merge(n,r.partials):n,l(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-color-picker-view",function(e){var r=[{intlKey:"search.RED",color:"ff2000",colorCode:"0"},{intlKey:"search.DARK_ORANGE",color:"a24615",colorCode:"1"},{intlKey:"search.ORANGE",color:"ff7c00",colorCode:"2"},{intlKey:"search.PALE_PINK",color:"ff9f9c",colorCode:"b"},{intlKey:"search.LEMON_YELLOW",color:"fffa00",colorCode:"4",useDarkCheckMark:!0},{intlKey:"search.SCHOOL_BUS_YELLOW",color:"ffcf00",colorCode:"3",useDarkCheckMark:!0},{intlKey:"search.GREEN",color:"90e200",colorCode:"5"},{intlKey:"search.LIME_GREEN",color:"00ab00",colorCode:"6"},{intlKey:"search.CYAN",color:"00b2d4",colorCode:"7"},{intlKey:"search.BLUE",color:"0062c6",colorCode:"8"},{intlKey:"search.VIOLET",color:"8c20ba",colorCode:"9"},{intlKey:"search.PINK",color:"f52394",colorCode:"a"},{intlKey:"search.WHITE",color:"ffffff",colorCode:"c",useDarkCheckMark:!0,useOutline:!0},{intlKey:"search.GRAY",color:"7c7c7c",colorCode:"d"},{intlKey:"search.BLACK",color:"000000",colorCode:"e"}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var o,l=this;return this.searchUrl=t.searchUrl||new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),o=this.searchUrl.getAPIParam(e.SearchHelper.API.colorCodes),this.selectedColors=o?o.split(","):[],this.colors=[],r.forEach(function(r){l.colors.push(e.merge(r,{selected:-1!==l.selectedColors.indexOf(r.colorCode)}))}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-color-picker",{colors:this.colors}),this.updateContainerDisabledState(),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",this.handleColorSwatchClick.bind(this),".color-swatch")),this.registerEventHandler(this.get("container").delegate("key",this.handleColorSwatchClick.bind(this),"down:13",".color-swatch")),this},onParentViewEvent:function(e,r){switch(r&&r.length&&r[0]){case"search:blackandwhiteStyleSelected":this.clearSelectedColors()}},handleColorSwatchClick:function(e){var r=e.target.getData("color-code"),t=this.selectedColors.indexOf(r);if(e.halt(),-1===t){if(this.isContainerDisabled())return;this.selectedColors.push(r),e.target.addClass("checked"),this.updateContainerDisabledState(),this.fire("subviewViewEvent","search:colorSelected")}else this.selectedColors.splice(t,1),e.target.removeClass("checked"),this.updateContainerDisabledState();this.updateSearchUrl()},updateContainerDisabledState:function(){this.selectedColors.length>=5?this.get("container").addClass("disabled"):this.get("container").removeClass("disabled")},isContainerDisabled:function(){return!!this.get("container").hasClass("disabled")},updateSearchUrl:function(){this.searchUrl.clearColorCodes(),this.isDefaultValue()||this.searchUrl.setAPIParam(e.SearchHelper.API.colorCodes,this.selectedColors.join(",")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultValue:function(){return!(this.selectedColors&&this.selectedColors.length)},clearSelectedColors:function(){this.selectedColors=[],this.colors.forEach(function(e){e.selected=0}),this.buildContainer(),this.updateSearchUrl()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-color-picker","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-style-picker",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,n,s){var t,r,i=null!=a?a:{},u=l.helperMissing,c=e.escapeExpression;return'\t\t<li class="style-button '+c("function"==typeof(r=null!=(r=l.cssClass||(null!=a?a.cssClass:a))?r:u)?r.call(i,{name:"cssClass",hash:{},data:s}):r)+(null!=(t=l.if.call(i,null!=a?a.useDarkCheckMark:a,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?t:"")+(null!=(t=l.if.call(i,null!=a?a.selected:a,{name:"if",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s}))?t:"")+'" data-style-value="'+c("function"==typeof(r=null!=(r=l.value||(null!=a?a.value:a))?r:u)?r.call(i,{name:"value",hash:{},data:s}):r)+'" data-tooltip-title="'+c((l.intlMessage||a&&a.intlMessage||u).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:s}))+'" tabindex="0" role="button" aria-label="'+c((l.intlMessage||a&&a.intlMessage||u).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:s}))+'"></li>\n'},2:function(e,a,l,n,s){return" dark-check"},4:function(e,a,l,n,s){return" checked"},compiler:[7,">= 4.0.0"],main:function(e,a,l,n,s){var t;return'<ul class="style-list">\n'+(null!=(t=l.each.call(null!=a?a:{},null!=a?a.styles:a,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?t:"")+"</ul>\n"},useData:!0}),n={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)}),e.Template.register("hermes/search-style-picker",function(a,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,l(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-style-picker-view",function(e){var t=[{intlKey:"search.BLACK_AND_WHITE",value:"blackandwhite",cssClass:"black-and-white"},{intlKey:"search.DEPTH_OF_FIELD",value:"depthoffield",cssClass:"depth-of-field"},{intlKey:"search.MINIMALIST",value:"minimalism",cssClass:"minimalist"},{intlKey:"search.PATTERNS",value:"pattern",cssClass:"patterns"}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(s){var l,i=this;return this.searchUrl=s.searchUrl||new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),l=this.searchUrl.getAPIParam(e.SearchHelper.API.styles),this.selectedStyles=l?l.split(","):[],this.styles=[],t.forEach(function(t){i.styles.push(e.merge(t,{selected:-1!==i.selectedStyles.indexOf(t.value)}))}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-style-picker",{styles:this.styles}),this},activate:function(){var e=this.get("container");return this.registerEventHandler(e.delegate("click",this.handleFilterClick.bind(this),".style-button")),this.registerEventHandler(e.delegate("key",this.handleFilterClick.bind(this),"down:13",".style-button")),this},onParentViewEvent:function(e,t){switch(t&&t.length&&t[0]){case"search:colorSelected":this.clearSelectedStyle("blackandwhite")}},handleFilterClick:function(e){var t=e.target.getData("style-value"),s=this.selectedStyles.indexOf(t);e.halt(),-1===s?(this.selectedStyles.push(t),e.target.addClass("checked"),"blackandwhite"===t&&this.fire("subviewViewEvent","search:blackandwhiteStyleSelected")):(this.selectedStyles.splice(s,1),e.target.removeClass("checked")),this.updateSearchUrl()},updateSearchUrl:function(){this.isDefaultValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.styles):this.searchUrl.setAPIParam(e.SearchHelper.API.styles,this.selectedStyles.join(",")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultValue:function(){return!(this.selectedStyles&&this.selectedStyles.length)},clearSelectedStyle:function(e){var t=this.selectedStyles.indexOf(e);-1!==t&&(this.selectedStyles.splice(t,1),this.styles.some(function(t){if(t.value===e)return t.selected=0,!0})),this.buildContainer(),this.updateSearchUrl()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-style-picker","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-orientation-picker",function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,n,t){var s,i,r=null!=e?e:{},o=l.helperMissing,u=a.escapeExpression;return'\t\t<div class="orientation-button '+u("function"==typeof(i=null!=(i=l.cssClass||(null!=e?e.cssClass:e))?i:o)?i.call(r,{name:"cssClass",hash:{},data:t}):i)+(null!=(s=l.if.call(r,null!=e?e.selected:e,{name:"if",hash:{},fn:a.program(2,t,0),inverse:a.noop,data:t}))?s:"")+' tabbable" data-orientation-value="'+u("function"==typeof(i=null!=(i=l.value||(null!=e?e.value:e))?i:o)?i.call(r,{name:"value",hash:{},data:t}):i)+'" data-tooltip-title="'+u((l.intlMessage||e&&e.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:null!=e?e.intlKey:e},data:t}))+'" data-tooltip-prefer-bottom="true" tabindex="0" aria-label="'+u("function"==typeof(i=null!=(i=l.value||(null!=e?e.value:e))?i:o)?i.call(r,{name:"value",hash:{},data:t}):i)+'"></div>\n'},2:function(a,e,l,n,t){return" checked"},compiler:[7,">= 4.0.0"],main:function(a,e,l,n,t){var s,i=null!=e?e:{};return'<p class="option-header tabbable" tabindex="0">'+a.escapeExpression((l.intlMessage||e&&e.intlMessage||l.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"search.ORIENTATION"},data:t}))+'</p>\n<div class="orientation-list">\n'+(null!=(s=l.each.call(i,null!=e?e.orientations:e,{name:"each",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+"</div>\n"},useData:!0}),n={};a.Array.each([],function(e){var l=a.Template.get("hermes/"+e);l&&(n[e]=l)}),a.Template.register("hermes/search-orientation-picker",function(e,t){return t=t||{},t.partials=t.partials?a.merge(n,t.partials):n,l(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-orientation-picker-view",function(e){var t=[{intlKey:"search.LANDSCAPE",value:"landscape",cssClass:"landscape",selected:!0},{intlKey:"search.PORTRAIT",value:"portrait",cssClass:"portrait",selected:!0},{intlKey:"search.SQUARE",value:"square",cssClass:"square",selected:!0},{intlKey:"search.PANORAMA",value:"panorama",cssClass:"panorama",selected:!0}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var a,s,n=this;return this.searchUrl=i.searchUrl||new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),a=this.searchUrl.getAPIParam(e.SearchHelper.API.orientation),this.selectedOrientations=[],this.orientations=[],t.forEach(function(t){s=e.merge(t),a&&(s.selected=-1!==a.indexOf(t.value)),s.selected&&n.selectedOrientations.push(s.value),n.orientations.push(s)}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-orientation-picker",{orientations:this.orientations}),this.updateContainerDisabledState(),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",this.handleOrientationClick.bind(this),".orientation-button")),this.registerEventHandler(this.get("container").delegate("key",this.handleOrientationClick.bind(this),"down:13",".orientation-button")),this},handleOrientationClick:function(t){var i=t.target.getData("orientation-value"),a=this.selectedOrientations.indexOf(i);if(t.halt(),-1===a)this.selectedOrientations.push(i),t.target.addClass("checked"),this.updateContainerDisabledState();else{if(this.isContainerDisabled())return;this.selectedOrientations.splice(a,1),t.target.removeClass("checked"),this.updateContainerDisabledState()}this.isDefaultValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.orientation):this.searchUrl.setAPIParam(e.SearchHelper.API.orientation,this.selectedOrientations.join(",")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},updateContainerDisabledState:function(){this.selectedOrientations.length<=1?this.get("container").addClass("disabled"):this.get("container").removeClass("disabled")},isContainerDisabled:function(){return!!this.get("container").hasClass("disabled")},isDefaultValue:function(){return this.selectedOrientations&&this.selectedOrientations.length===t.length}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-orientation-picker","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-min-size-picker",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,n,s){var t,i=null!=a?a:{},r=l.helperMissing,u=e.escapeExpression;return'\t\t<li class="size-button'+(null!=(t=l.if.call(i,null!=a?a.isFirst:a,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?t:"")+(null!=(t=l.if.call(i,null!=a?a.isLast:a,{name:"if",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s}))?t:"")+(null!=(t=l.if.call(i,null!=a?a.selected:a,{name:"if",hash:{},fn:e.program(6,s,0),inverse:e.noop,data:s}))?t:"")+' tabbable"'+(null!=(t=l.if.call(i,null!=a?a.value:a,{name:"if",hash:{},fn:e.program(8,s,0),inverse:e.noop,data:s}))?t:"")+' data-tooltip-title="'+u((l.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.titleIntlKey:a},data:s}))+(null!=(t=l.if.call(i,null!=a?a.value:a,{name:"if",hash:{},fn:e.program(10,s,0),inverse:e.noop,data:s}))?t:"")+'" data-tooltip-prefer-bottom="true" tabindex="0" aria-label="'+u((l.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.titleIntlKey:a},data:s}))+(null!=(t=l.if.call(i,null!=a?a.value:a,{name:"if",hash:{},fn:e.program(10,s,0),inverse:e.noop,data:s}))?t:"")+'"><span aria-hidden="true">'+u((l.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:s}))+"<span></li>\n"},2:function(e,a,l,n,s){return" first"},4:function(e,a,l,n,s){return" last"},6:function(e,a,l,n,s){return" selected"},8:function(e,a,l,n,s){var t;return' data-size-value="'+e.escapeExpression("function"==typeof(t=null!=(t=l.value||(null!=a?a.value:a))?t:l.helperMissing)?t.call(null!=a?a:{},{name:"value",hash:{},data:s}):t)+'"'},10:function(e,a,l,n,s){var t;return" ("+e.escapeExpression("function"==typeof(t=null!=(t=l.value||(null!=a?a.value:a))?t:l.helperMissing)?t.call(null!=a?a:{},{name:"value",hash:{},data:s}):t)+")"},compiler:[7,">= 4.0.0"],main:function(e,a,l,n,s){var t,i=null!=a?a:{};return'<p class="option-header tabbable" tabindex="0">'+e.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"search.MINIMUM_SIZE"},data:s}))+'</p>\n<ul class="size-list">\n'+(null!=(t=l.each.call(i,null!=a?a.sizes:a,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?t:"")+"</ul>\n"},useData:!0}),n={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)}),e.Template.register("hermes/search-min-size-picker",function(a,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,l(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-min-size-picker-view",function(e){var t=[{intlKey:"search.SMALL_SHORT",titleIntlKey:"search.SMALL_SHOW_ALL_SIZES",selected:!0},{intlKey:"search.MEDIUM_SHORT",titleIntlKey:"search.MEDIUM",value:"640"},{intlKey:"search.LARGE_SHORT",titleIntlKey:"search.LARGE",value:"1024"}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var s,r,a,h,l=this;return this.searchUrl=i.searchUrl||new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),s=this.searchUrl.getAPIParam(e.SearchHelper.API.dimensionSearchMode),r=this.searchUrl.getAPIParam(e.SearchHelper.API.height),a=this.searchUrl.getAPIParam(e.SearchHelper.API.width),this.sizes=[],t.forEach(function(t){h=e.merge(t),s&&r&&a&&(h.selected=t.value&&r===t.value&&a===t.value&&"min"===s),h.selected&&l.set("selectedSize",h.value),l.sizes.push(h)}),this.sizes[0].isFirst=!0,this.sizes[this.sizes.length-1].isLast=!0,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-min-size-picker",{sizes:this.sizes}),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",this.handleSizeClick.bind(this),".size-button")),this.registerEventHandler(this.get("container").delegate("key",this.handleSizeClick.bind(this),"down:13",".size-button")),this},handleSizeClick:function(t){var i=t.currentTarget.getData("size-value");t.halt(),this.get("selectedSize")!==i&&(this.set("selectedSize",i),this.get("container").one(".size-button.selected").removeClass("selected"),t.currentTarget.addClass("selected"),!this.get("selectedSize")||this.isDefaultValue()?(this.searchUrl.removeAPIParam(e.SearchHelper.API.dimensionSearchMode),this.searchUrl.removeAPIParam(e.SearchHelper.API.height),this.searchUrl.removeAPIParam(e.SearchHelper.API.width)):(this.searchUrl.setAPIParam(e.SearchHelper.API.dimensionSearchMode,"min"),this.searchUrl.setAPIParam(e.SearchHelper.API.height,this.get("selectedSize")),this.searchUrl.setAPIParam(e.SearchHelper.API.width,this.get("selectedSize"))),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl))},isDefaultValue:function(){return!this.get("selectedSize")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-min-size-picker","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-content-picker",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,l,t){var s,i=null!=a?a:{},r=n.helperMissing,c=e.escapeExpression;return'\t\t<li class="content-button'+(null!=(s=n.if.call(i,null!=a?a.selected:a,{name:"if",hash:{},fn:e.program(2,t,0),inverse:e.noop,data:t}))?s:"")+' tabbable"'+(null!=(s=n.if.call(i,null!=a?a.value:a,{name:"if",hash:{},fn:e.program(4,t,0),inverse:e.noop,data:t}))?s:"")+' data-tooltip-title="'+c((n.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.titleIntlKey:a},data:t}))+'" data-tooltip-prefer-bottom="true" tabindex="0">'+c((n.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:null!=a?a.intlKey:a},data:t}))+"</li>\n"},2:function(e,a,n,l,t){return" checked"},4:function(e,a,n,l,t){var s;return' data-content-value="'+e.escapeExpression("function"==typeof(s=null!=(s=n.value||(null!=a?a.value:a))?s:n.helperMissing)?s.call(null!=a?a:{},{name:"value",hash:{},data:t}):s)+'"'},compiler:[7,">= 4.0.0"],main:function(e,a,n,l,t){var s,i=null!=a?a:{};return'<p class="option-header tabbable" tabindex="0">'+e.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"search.CONTENT"},data:t}))+'</p>\n<ul class="content-list">\n'+(null!=(s=n.each.call(i,null!=a?a.contents:a,{name:"each",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?s:"")+"</ul>\n"},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/search-content-picker",function(a,t){return t=t||{},t.partials=t.partials?e.merge(l,t.partials):l,n(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});